(()=>{var e={864:()=>{const e=document.querySelector("#type"),t=document.querySelector("#price");e.addEventListener("click",(function(){switch(e.value){case"bungalow":t.min=0;break;case"flat":t.min=1e3;break;case"house":t.min=5e3;break;case"palace":t.min=1e4}}));const r=document.querySelector("#timein"),o=document.querySelector("#timeout");r.addEventListener("change",(function(){switch(r.value){case"12:00":o.value="12:00";break;case"13:00":o.value="13:00";break;case"14:00":o.value="14:00"}})),o.addEventListener("change",(function(){switch(o.value){case"12:00":r.value="12:00";break;case"13:00":r.value="13:00";break;case"14:00":r.value="14:00"}}));const a=document.querySelector("#room_number"),c=document.querySelector("#capacity").children;a.addEventListener("click",(function(){for(let e=0;e<c.length;e++)c[e].setAttribute("disabled","");switch(a.value){case"1":c[2].removeAttribute("disabled");break;case"2":c[1].removeAttribute("disabled"),c[2].removeAttribute("disabled");break;case"3":c[0].removeAttribute("disabled"),c[1].removeAttribute("disabled"),c[2].removeAttribute("disabled");break;case"100":c[3].removeAttribute("disabled")}}));const n=document.querySelector("#avatar"),s=document.querySelector(".ad-form-header__preview").children,i=document.querySelector("#images"),d=document.querySelector(".ad-form__photo"),l=["gif","jpg","jpeg","png"];n.addEventListener("change",(()=>{const e=n.files[0],t=e.name.toLowerCase();if(l.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{s[0].src=t.result})),t.readAsDataURL(e)}})),i.addEventListener("change",(()=>{const e=i.files[0],t=e.name.toLowerCase();if(l.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{d.insertAdjacentHTML("beforeend",'  <img src="'+t.result+'" alt="Аватар пользователя" width="45" height="40">')})),t.readAsDataURL(e)}}))}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,r),c.exports}(()=>{"use strict";r(864),Math.round10||(Math.round10=function(e,t){return function(e,t,r){return void 0===r||0==+r?Math.round(t):(t=+t,r=+r,isNaN(t)||"number"!=typeof r||r%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-r:-r)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+r:r))))}(0,e,t)});const e=document.querySelector(".ad-form"),t=e.querySelectorAll("fieldset"),o=document.querySelector(".map__filters"),a=o.querySelectorAll("fieldset"),c=o.querySelectorAll("select"),n=document.querySelector("#address"),s=e=>"Escape"===e.key||"Esc"===e.key;e.addEventListener("submit",(t=>{var r,o,a;t.preventDefault(),r=()=>{e.reset();const t=document.querySelector("#success").content.querySelector(".success").cloneNode(!0);document.body.append(t),document.addEventListener("keydown",(e=>{s(e)&&t.classList.add("hidden")})),document.addEventListener("click",(()=>{t.classList.add("hidden")})),l.setLatLng([35.68397,139.75])},o=()=>{const e=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),t=e.querySelector(".error__button");document.body.append(e),document.addEventListener("keydown",(t=>{s(t)&&e.classList.add("hidden")})),t.addEventListener("click",(()=>{e.classList.add("hidden")}))},a=new FormData(t.target),fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:a}).then((e=>{e.ok?r():o()})).catch((()=>{o()}))})),e.classList.add("ad-form--disabled"),t.forEach((e=>{e.setAttribute("disabled","")})),o.classList.add("map__filters--disabled"),a.forEach((e=>{e.setAttribute("disabled","")})),c.forEach((e=>{e.setAttribute("disabled","")})),window.addEventListener("load",(()=>{e.classList.remove("ad-form--disabled"),t.forEach((e=>{e.removeAttribute("disabled")})),o.classList.remove("map__filters--disabled"),a.forEach((e=>{e.removeAttribute("disabled")})),c.forEach((e=>{e.removeAttribute("disabled")}))}));const i=L.map("map-canvas").setView({lat:35.68379,lng:139.75021},12);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(i);const d=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),l=L.marker({lat:35.68379,lng:139.75021},{draggable:!0,icon:d}),u=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),p=document.querySelector("#housing-type"),m=document.querySelector("#housing-price"),h=document.querySelector("#housing-rooms"),y=document.querySelector("#housing-guests"),f=[p,m,h,y],b=[document.querySelector("#filter-wifi"),document.querySelector("#filter-dishwasher"),document.querySelector("#filter-parking"),document.querySelector("#filter-washer"),document.querySelector("#filter-elevator"),document.querySelector("#filter-conditioner")],v=L.layerGroup().addTo(i),g=e=>{v.clearLayers();const t=e=>{const t=e.offer;let r=0;switch(p.value===t.type&&(r+=1),m.value){case"any":break;case"middle":case"low":case"high":r+=1}switch(h.value){case"1":case"2":case"3":r+=1}switch(y.value){case"1":case"2":case"0":r+=1}return b.forEach((e=>{e.checked&&(r+=1)})),r},r=e=>{const t=e.offer;let r=0;switch(p.value===t.type&&(r+=1),m.value){case"any":break;case"middle":t.price>1e4&&t.price<5e4&&(r+=1);break;case"low":t.price<1e4&&(r+=1);break;case"high":t.price>5e4&&(r+=1)}switch(h.value){case"1":1===t.rooms&&(r+=1);break;case"2":2===t.rooms&&(r+=1);break;case"3":3===t.rooms&&(r+=1)}switch(y.value){case"1":1===t.guests&&(r+=1);break;case"2":2===t.guests&&(r+=1);break;case"0":0===t.guests&&(r+=1)}return b.forEach((e=>{const o=t.features;e.checked&&null!=o&&o.forEach((t=>{e.value===t&&(r+=1)}))})),r};let o=[];for(let r=0;r<e.length;r++)o.push(t(e[r]));const a=document.querySelector("#card").content.querySelector(".popup");e.slice().sort(((e,t)=>{const o=r(e);return r(t)-o})).slice(0,10).forEach((e=>{if(r(e)===Math.max(...o)){const t=a.cloneNode(!0),r=e.offer;t.querySelector(".popup__title").textContent=r.title,t.querySelector(".popup__text--address").textContent=r.address,t.querySelector(".popup__text--price").textContent=r.price+" ₽/ночь";const o=()=>{switch(r.type){case"palace":return"Дворец";case"flat":return"Квартира";case"house":return"Дом";case"bungalow":return"Бунгало"}};t.querySelector(".popup__type").textContent=o(),t.querySelector(".popup__text--capacity").textContent=r.rooms+" комнаты для "+r.guests+" гостей",t.querySelector(".popup__text--time").textContent="Заезд после "+r.checkin+", выезд до "+r.checkout;const c=t.querySelector(".popup__features");for(let e=0;e<6;e++)c.removeChild(t.querySelector(".popup__feature"));const n=r.features;if(null!=n)for(let e=0;e<n.length;e++)c.insertAdjacentHTML("beforeend",'  <li class="popup__feature popup__feature--'+n[e]+'"></li>');t.querySelector(".popup__description").textContent=r.description;const s=t.querySelector(".popup__photos");s.removeChild(t.querySelector(".popup__photo"));const i=r.photos;if(null!=i)for(let e=0;e<i.length;e++)s.insertAdjacentHTML("beforeend",'  <img src="'+i[e]+'" class="popup__photo" width="45" height="40" alt="Фотография жилья">');const d=e.author;t.querySelector(".popup__avatar").src=d.avatar;const l=e.location;L.marker({lat:l.lat,lng:l.lng},{icon:u}).addTo(v).bindPopup(t)}}))};var S,q;S=e=>{g(e),f.forEach((t=>{t.addEventListener("change",_.debounce((()=>g(e)),400))})),b.forEach((t=>{t.addEventListener("click",_.debounce((()=>g(e)),400))}))},q=()=>{(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Не удалось загрузить данные. Попробуйте ещё раз",document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})()},fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{S(e)})).catch((e=>{q()})),l.addTo(i),n.value="35.68397, 139.75",l.on("moveend",(e=>{const t=e.target.getLatLng();n.value=Math.round10(t.lat,-5)+", "+Math.round10(t.lng,-5)}))})()})();
//# sourceMappingURL=main.bundle.js.map